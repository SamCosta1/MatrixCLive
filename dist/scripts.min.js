function AllCalculations(t,e){function i(){var t="$$",e=new CalculationArray;t+="\\text{"+n+"}="+a.getTex()+"$$";for(var i in r){t+=o+funcENUM.getString(r[i])+"</div>";try{var s=new CalculationStep({type:r[i],op1:a});s.data.result=a.performFunction(r[i],null,s),t+="$$"+s.data.result.getTex()+"$$",e.push(s)}catch(e){t+="-"}}return e.render($(".sidebarBody")),t}var a=e,n=t,r=[funcENUM.TRANSPOSE,funcENUM.INVERSE,funcENUM.DET,funcENUM.ROWREDUCE],o='<div class="allCalcLabel">';return{getTex:i}}function ApplicationManager(){function t(){e=new Variables,a=new Popup,r=new Sidebar,n=new MatrixInputManager(e,a),i=new CommandLine(e,n).init(),n.init(),r.init(),a.init()}var e=null,i=null,a=null,n=null,r=null;return{init:t}}function CalculationArray(){this.steps=[]}function CalculationStep(t){this.data=t,this.subSteps=[]}function CommandLine(t,e){function i(){u.bind("input",s),u.keyup(a)}function a(t){t.stopImmediatePropagation();var e=t.keyCode?t.keyCode:t.which;switch(e){case 13:var i=u.val().slice(d.length);f.push(i),n(i);break;case 38:(returned=f.popUp())&&$(u).val(d+returned);break;case 40:(returned=f.popDown())&&$(u).val(d+returned);break;default:f.resetCount()}}function n(t){try{var e=Date.now();l.hide();var i=g.parse(t);m.render(i),u.val(d);var a=Date.now()-e;o(a),console.log("Operation done in "+a+"ms")}catch(t){r(t),u.val(u.val().replace(/\n/g,""))}}function r(t){console.log(t),p.removeClass("success"),l.text(t).show()}function o(t){p.addClass("success"),l.text("Command Successful! ("+t+" ms)").show(200),setTimeout(function(){l.hide(500)},2e3)}function s(){var t=$(u).val();h.test(t)||$(u).val(d)}function c(){function t(t){a.indexOf(t)<0&&/\S/.test(t)&&"undefined"!==a&&(a.push(t.replace(/\n/g,"")),n++)}function e(){return n>0&&a.length>0&&(n--,a[n])}function i(){return n<a.length-1&&a.length>0&&(n++,a[n])}var a=[],n=-1;return{push:t,popUp:e,popDown:i,resetCount:function(){n=a.length}}}var u=$("#cmdinput"),l=$("#errDisplay"),p=$(".errContainer"),d="MatCalculator >> ",h=new RegExp("^"+d,"i"),f=new c,m=e,g=new Parser(t);return{init:i}}function Fraction(t,e){this.top=t,this.bottom=e,void 0===t?(this.top="0",this.bottom="1"):void 0===e&&(this.bottom="1"),this.bottom=this.bottom.toString(),this.top=this.top.toString(),this.top.indexOf("/")>0&&(this.top=t.split("/")[0],this.bottom=t.split("/")[1]),this.top=new Big(this.top),this.bottom=new Big(this.bottom);var i=!this.top.mod(1).eq(0);if(botDec=!this.bottom.mod(1).eq(0),i||botDec){var a=i?this.top.toString().split(".")[1].length:0,n=botDec?this.bottom.toString().split(".")[1].length:0,r=Big(10).pow(n>a?n:a);this.top=this.top.times(r),this.bottom=this.bottom.times(r)}this.simplify()}function GCD(t,e){if(e.eq(0))return 1;var i=t.mod(e);return i.eq(0)?e:GCD(e,i)}function Matrix(t,e){this.matrix=t,t&&t[0]instanceof Fraction&&(this.matrix=[this.matrix]),this.multiplier=new Fraction("1"),void 0===t?this.matrix=this.getZeros(3).matrix:isNaN(t)||(this.matrix=this.getZeros(t,e).matrix)}function getEnum(t){switch(t.toLowerCase()){case"transpose":case"trans":return funcENUM.TRANSPOSE;case"inverse":case"inv":return funcENUM.INVERSE;case"rank":return funcENUM.RANK;case"det":case"determinant":return funcENUM.DET;case"eigen":return funcENUM.EIGEN;case"diagonalize":return funcENUM.DIAGONALIZE;case"rowreduce":return funcENUM.ROWREDUCE;case"solveaugmented":case"solveaugmentedmatrix":return funcENUM.SOLVAUG;case"id":case"identity":return funcENUM.ID;case"zeros":return funcENUM.ZEROS}return funcENUM.NONE}function MatrixInputManager(t,e){function a(){v.bind("click",function(){r()}),v.trigger("click")}function n(t){x.get(t.lbl)?m(t.lbl,t.matrix):r(t.lbl,t.matrix)}function r(t,e){void 0===t&&(t=x.getNextFreeLetter());var a,n;null!==e&&void 0!==e||(e=new Matrix),e instanceof Matrix?(n=e.numCols(),a=e.numRows()):a=n=1,x.set(t,e);var r=$('<div id="MAT-'+t+'" class="matInput draggable drag-drop" data-clicked="0">'),f=$('<span class="label noSelect">'),m=$('<label class="noSelect">'),g=$('<input class="clickedit" type: "text">');m.append(t),f.append(m),f.append(g),f.append("     = "),r.append(f);var v=$('<div class="matContainer">'),w=$("<table>",{class:isNaN(e)?"matGui":"",id:"t"+b});for(w.attr("data-cols",n),w.attr("data-rows",a),i=0;i<a;i++){var C=$("<tr>");for(j=0;j<n;j++){var M=$("<td>");M.append(p(i,j,e instanceof Matrix?e.getCell(i,j).toString():e instanceof Fraction?e.toString():e)),C.append(M)}w.append(C)}if(v.append(w),r.append(v),e instanceof Matrix){$modifiers=$('<div class="guiModifiers">'),$hiddenBtns=$('<div class="MatrixOpButtons noSelect">'),$dragHandle=$('<div class="dragHandle icon-drag-handle">'),$allCalcButton=$('<div class="allCalcButton icon-info">'),$allCalcButton.click(d),$hiddenBtns.append($dragHandle),$hiddenBtns.append($allCalcButton);var y=function(t){return $('<div class="icon-'+t+'-arrow">')};$colbtn=$('<button class="addCol colButton rowColModifier noSelect">'),$colbtn.append(y("right")),$rowbtn=$('<button class="addRow rowButton rowColModifier noSelect">'),$rowbtn.append(y("down")),$rmvColbtn=$('<button class="rmvCol colButton rowColModifier noSelect">'),$rmvColbtn.append(y("left")),$rmvRowbtn=$('<button class="rmvRow rowButton rowColModifier noSelect addLeftMargin">'),$rmvRowbtn.append(y("up")),$colbtn.attr("data-tableid","t"+b),$rowbtn.attr("data-tableid","t"+b),$rmvRowbtn.attr("data-tableid","t"+b),$rmvColbtn.attr("data-tableid","t"+b),$colbtn.click(c),$rowbtn.click(u),$rmvColbtn.click(s),$rmvRowbtn.click(l),r.click(o),b++,$modifiers.append($rmvRowbtn),$modifiers.append($rowbtn),$modifiers.append($rmvColbtn),$modifiers.append($colbtn),$modifiers.append($hiddenBtns),r.append($modifiers)}$(".matDefinitions").append(r),$(".clickedit").hide().focusout(h).keyup(function(t){return t.stopImmediatePropagation(),!(t.which&&13==t.which||t.keyCode&&13==t.keyCode)||(h(t),!1)}).prev().click(function(t){t.stopImmediatePropagation(),$(this).hide(),$(this).next().show().focus()})}function o(t){t.stopImmediatePropagation();var e=$(this).attr("id");1==$(this).attr("data-clicked")?($(this).css("background-color","rgba(204, 204, 204, 0.2)"),$(this).attr("data-clicked",0),w.splice(w.indexOf(e),1)):($(this).css("background-color","rgba(99, 182, 255, 0.2)"),$(this).attr("data-clicked",1),w.push(e)),$selectedVariablesMatrix=this}function s(t){t.stopImmediatePropagation();var e=$("#"+$(this).attr("data-tableid")),i=parseInt(e.attr("data-cols")),a=parseInt(e.attr("data-rows"));if(i>1){$("#"+$(this).attr("data-tableid")+" td:last-child").remove(),i--,e.attr("data-cols",i);var n=$(this).closest(".matInput").attr("id").split("-")[1];x.get(n).resize(a,i)}}function c(t){t.stopImmediatePropagation();var e=0;$table=$("#"+$(this).attr("data-tableid"));var i=$table.attr("data-cols")-1,a=$table.attr("data-rows");$table.attr("data-cols",i+2),$table.find("tr").each(function(){var t=$("<td>");t.append(p(e,i+1,"0")),e++,$(this).find("td").eq(i).after(t)});var n=$(this).closest(".matInput").attr("id").split("-")[1];x.get(n).resize(parseInt(a),i+2)}function u(t){t.stopImmediatePropagation(),$table=$("#"+$(this).attr("data-tableid"));var e=$table.attr("data-cols"),a=$table.attr("data-rows");for($table.attr("data-rows",parseInt(a)+1),$tr=$("<tr>"),i=0;i<e;i++)$td=$("<td>"),$td.append(p(a,i,"0")),$tr.append($td);$table.append($tr);var n=$(this).closest(".matInput").attr("id").split("-")[1];x.get(n).resize(parseInt(a)+1,parseInt(e))}function l(t){t.stopImmediatePropagation();var e=$("#"+$(this).attr("data-tableid")),i=parseInt(e.attr("data-rows")),a=parseInt(e.attr("data-cols"));if(i>1){$("#"+$(this).attr("data-tableid")+" tr:last-child").remove(),i--,e.attr("data-rows",i);var n=$(this).closest(".matInput").attr("id").split("-")[1];x.get(n).resize(i,a)}}function p(t,e,i){var a=$("<input>",{class:"matrixCell",type:"text"});return a.val(i),"0"==i&&a.css("color","gray"),a.attr("data-row",t),a.attr("data-col",e),a.click(function(t){t.stopImmediatePropagation(),"0"==$(this).val()&&$(this).val(""),$(this).css("color","black")}),a.change(function(t){t.stopImmediatePropagation();var e=$(this).closest(".matInput").attr("id").split("-")[1],i=$(this).attr("data-row"),n=$(this).attr("data-col");""===$(this).val().trim()?(a.css("color","gray"),x.get(e).update(i,n,0),$(this).val("0")):x.get(e).update(i,n,$(this).val())}),a.keyup(function(t){t.stopImmediatePropagation()}),a}function d(t){t.stopImmediatePropagation();var e=$(this).closest(".matInput").attr("id").split("-")[1];C.render({header:"Stuff about "+e+"!!",body:new AllCalculations(e,x.get(e)).getTex()})}function h(t){t.stopImmediatePropagation();var e=$(t.target),i=e&&e.prev(),a=f(e.val()),n=!1;if(x.isValid(a,!1)){i.text(a);var r=x.get(i.closest("div").attr("id").split("-")[1]);x.delete(i.closest("div").attr("id").split("-")[1]),x.set(a,r),i.closest("div").attr("id","MAT-"+a)}else i.text(i.closest("div").attr("id").split("-")[1]),n=!0;e.hide(),i.show(),e.val(""),n&&errorHandle("Invalid Variable Name :(")}function f(t){return t=t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()}),t=t.replace(/ /g,"").replace(/-/g,""),t.length>1&&(t=t.charAt(0).toLowerCase()+t.slice(1)),t}function m(t,e){if(x.set(t,e),e instanceof Matrix){var i=parseInt(e.numRows()-$("#MAT-"+t).find("table").attr("data-rows")),a=parseInt(e.numCols()-$("#MAT-"+t).find("table").attr("data-cols"));if(0!==i||0!==a){for(var n=$("#MAT-"+t).find(".guiModifiers"),r=n.find(".addCol"),o=n.find(".rmvCol"),s=n.find(".addRow"),c=n.find(".rmvRow"),u=0;u<Math.abs(i);u++)i<0?c.trigger("click"):s.trigger("click");for(u=0;u<Math.abs(a);u++)a<0?o.trigger("click"):r.trigger("click")}}$("#MAT-"+t).find("table tr").each(function(){$(this).find("td").each(function(){var t=$(this).find("input"),i=t.attr("data-row"),a=t.attr("data-col");t.val(e instanceof Matrix?e.getCell(i,a):e.toString())})})}function g(t){x.delete($(t).attr("id").split("-")[1]),$(t).remove(),$("#bin").removeClass("binOpen")}var v=$("#btnNewMat"),w=[],b=0,x=t,C=e;return interact(".dropzone").dropzone({accept:".matInput",ondragenter:function(t){$(t.relatedTarget).addClass("deleting"),$("#bin").addClass("binOpen")},ondragleave:function(t){$(t.relatedTarget).removeClass("deleting"),$("#bin").removeClass("binOpen")},ondrop:function(t){g(t.relatedTarget);var e=w.indexOf($(t.relatedTarget).attr("id"));e!=-1&&w.splice(e,1)}}),$(document).keyup(function(t){if(46==t.keyCode)for(var e in w)g($("#"+w[e]));w=[]}),{init:a,render:n}}function Parser(t){function e(t){if(t=t.replace(/ /g,"").replace(/\n/g,""),t.indexOf(";")>0){var c=t.split(";");for(var u in c)e(c[u])}else if(""!==t){var p=t,d="",h=!1;if(t.indexOf("=")>0){if(h=!0,d=t.split("=")[0],!l.isValid(d,!0))throw"Invalid Variable Name :(";t=t.split("=")[1]}else d=l.getNextFreeLetter();t="("+t+")";var f=new CalculationArray,m=i(t);if(!h&&3==m.length)return $("#MAT-"+p).trigger("click"),void $("#MAT-"+p).get(0).scrollIntoView();for(var g=0;g<m.length;g++)if(o(m[g])){for(var v=g;!s(m[v]);){if(r(m[v])){var w=new CalculationStep({type:m[v],op1:m[v-1],op2:m[v+1]}),b=n(m[v],m[v-1],m[v+1],w);w.data.result=b,f.push(w),m.splice(v,2),m[v-1]=b}v--}if(funcENUM.isFunction(m[v-1])){for(var x=[],C=0;!o(m[C+(v+1)]);)","!=m[C+(v+1)]&&x.push(m[C+(v+1)]),C++;var M=new CalculationStep({type:m[v-1],op1:x[0]}),y=a(m[v-1],x,M);M.data.result=y,f.push(M),m.splice(v,C+2),m[v-1]=y}else m.splice(v,1),m.splice(v+1,1);if(0===v)break;g=v-1}return f.render($(".sidebarBody")),{lbl:d,matrix:m[0].clone()}}}function i(t){var e=1,i=0,a=[];a.add=function(t){s(t)?e++:o(t)&&i++,this.push(t)},a.push("(");for(var n=1;n<t.length;n++){if(u(t[n])&&!u(t[n-1])){for(var r=n-1,c="";!u(t[r]);)c=t[r]+c,r--;var p;if(isNaN(c)){if((p=getEnum(c))==funcENUM.NONE&&"undefined"==typeof(p=l.get(c))&&","!=(p=c))throw"Sorry, I don't know what '"+c+"' is :("}else p=new Fraction(c),"-"==a[a.length-1]&&isNaN(a[a.length-2])&&(a.pop(),p=p.times(-1)),"+"==a[a.length-1]&&isNaN(a[a.length-2])&&a.pop();a.push(p)}u(t[n])&&a.add(t[n])}if(e>i)throw"Unexpected character (";if(i>e)throw"Unexpected character )";return a}function a(t,e,i){if(e[0]instanceof Matrix)return e[0].performFunction(t,null,i);if(t!=funcENUM.ID&&t!=funcENUM.ZEROS)throw"Cannot perform operation: "+funcENUM.getString(t)+" of "+e[0];return(new Matrix).performFunction(t,e,i)}function n(t,e,i,a){var n;switch(t){case"+":if(e instanceof Matrix&&!(i instanceof Matrix)||i instanceof Matrix&&!(e instanceof Matrix))throw"You can't add a matrix and number sorry!";n=e.add(i);break;case"-":if(e instanceof Matrix&&!(i instanceof Matrix)||i instanceof Matrix&&!(e instanceof Matrix))throw"You can't add a matrix and number sorry!";n=e.subtract(i);break;case"/":if(!(e instanceof Matrix)&&i instanceof Matrix)throw"You can't divide a number by a matrix!";n=e.divide(i,a);break;case"*":n=e instanceof Matrix?e.times(i):i instanceof Matrix?i.times(e):e.times(i);break;case"^":if(e instanceof Matrix)e.step=a,n=i instanceof Matrix?e.conjugate(i):e.power(i);else{if(!(e instanceof Fraction&&i instanceof Fraction))throw"That's not valid maths! ";n=e.power(i)}}return n}function r(t){return"+^-*/".split("").indexOf(t)>=0}function o(t){return")"===t}function s(t){return"("===t}function c(t){return o(t)||s(t)}function u(t){return r(t)||c(t)||","==t}var l=t;return{parse:e}}function Popup(){function t(){n.hide(),r.append(o),r.append(s),n.append(r),n.append(c),l.append(n),u.resize(i),l.bind("sidebarResize",i),l.bind("closePopup",e),s.bind("click",e),i()}function e(){n.hide()}function i(){console.log("resize",o.outerHeight(!0)),n.width(u.width()-23-$(".sidebar").width()),c.height(n.height()-o.outerHeight(!0))}function a(t){o.empty(),c.empty(),o.append(t.header),c.append(t.body),MathJax.Hub.Queue(["Typeset",MathJax.Hub,".popUpBody"]),MathJax.Hub.Queue(function(){n.show(),i()})}var n=$('<div class="popUpContainer">'),r=$('<div class="popUpHeader noSelect">'),o=$('<p class="popUpHeaderText">'),s=$('<div class="closebtn icon-close">'),c=$('<div class="popUpBody">'),u=$(window),l=$("body");return{render:a,init:t}}function Sidebar(){function t(){c.bind("mousedown",o),c.dblclick(r),u.click(n),l.click(a),$(document).mouseup(function(t){$(document).unbind("mousemove")})}function e(){s.width(.75*$(window).width()),u.removeClass("expand")}function i(){s.width(d),u.addClass("expand")}function a(){l.hasClass("unfullScreen")?s.css("width",p):(p=s.width(),s.width($(window).width())),l.toggleClass("unfullScreen")}function n(){s.width()==d?e():i(),$("body").trigger("sidebarResize")}function r(){s.width()!==d?i():e(),$("body").trigger("sidebarResize")}function o(){$(document).bind("mousemove",function(t){t.stopImmediatePropagation(),$("body").trigger("sidebarResize");var e=s.position().left-t.pageX;(e<0||s.width()<$(window).width())&&s.width(s.width()+s.position().left-t.pageX),s.width()>$(window).width()&&s.width($(window).width()),s.width()!==d?u.removeClass("expand"):u.addClass("expand")})}var s=$(".sidebar"),c=($(".sidebarBody"),$(".handle")),u=$(".snapHandle"),l=$(".fullScreen"),p=d,d=c.width();return{init:t}}function Variables(){function t(t){return r.get(t)}function e(t,e){r.set(t,e)}function i(t){r.delete(t)}function a(t,e){return/^[a-z0-9]+$/i.test(t)&&(!!e||void 0===r.get(t))&&getEnum(t)===funcENUM.NONE}function n(){if(s++,s>=o.length&&(s=0),a(o[s]))return o[s];var t=o[s]+parseInt(100*Math.random());return a(t)?t:void n()}var r=new Map,o="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),s=-1;return{get:t,set:e,getNextFreeLetter:n,isValid:a,delete:i}}CalculationArray.prototype.push=function(t){this.steps.push(t)},CalculationArray.prototype.render=function(t){if(0!==this.steps.length){for(var e=$('<div class="calculation">'),i=0;i<this.steps.length;i++)this.steps[i].render(e);t.prepend(e),MathJax.Hub.Queue(["Typeset",MathJax.Hub])}},CalculationStep.prototype.push=function(t){this.subSteps.push(t)},CalculationStep.prototype.length=function(){return this.subSteps.length},CalculationStep.prototype.render=function(t){var e=$("<div>",{class:"calcStepContainer"});if(this.length()>0){for(var i=$("<div>",{class:"calcStepContainer subContainer"}),a=0;a<this.length();a++)this.subSteps[a].render(i);e.append(i)}var n=$("<div>",{class:"calcStepContainer resultContainer"});this.renderThis(n),e.append(n),t.append(e)},CalculationStep.prototype.renderThis=function(t){var e="$$";switch(this.data.type){case funcENUM.INVERSE:e+="\\text{inverse} \\Bigg("+this.data.op1.getTex()+"\\Bigg) = "+this.data.result.getTex();break;case funcENUM.DET:e+="\\text{determinant} \\Bigg("+this.data.op1.getTex()+"\\Bigg) = "+this.data.result.getTex();break;case funcENUM.ROWREDUCE:e+="\\text{reduced row echelon form of }"+this.data.op1.getTex()+" is "+this.data.result.getTex();break;case funcENUM.TRANSPOSE:e+="\\text{transpose} \\Bigg("+this.data.op1.getTex()+"\\Bigg) = "+this.data.result.getTex();break;case"+":case"-":e+=this.data.op1.getTex()+this.data.type+this.data.op2.getTex()+"="+this.data.result.getTex();break;case"*":e+=this.data.op1.getTex()+"\\times"+this.data.op2.getTex()+"="+this.data.result.getTex();break;case"/":e+="\\frac{"+this.data.op1.getTex()+"}{"+this.data.op2.getTex()+"}="+this.data.result.getTex();break;case"^":e+="("+this.data.op1.getTex()+")^{"+this.data.op2.getTex()+"} = "+this.data.result.getTex();break;case"splitAug":e+="\\text{Take the right hand side as the inverse: }"+this.data.op1.getTex();break;case"swap":e+="\\text{Swap } R_"+(this.data.op1+1)+"\\text{ and }R_ "+(this.data.op2+1)+" => "+this.data.result.getTex();break;case"augment":e+="\\text{augment } "+this.data.op1.getTex()+" \\text{with} "+this.data.op2.getTex()+" \\text{"+this.data.message+"} \\\\ =>"+this.data.result.getTex();break;case"multiplyRow":e+="\\text{Multiply } R_"+(this.data.rowNum+1)+"\\text{ by }"+this.data.op2.getTex()+"\\\\"+this.data.op1.getRowTex(this.data.rowNum)+"\\times"+this.data.op2.getTex()+"\\rightarrow"+this.data.result.getTex();break;case"subtractRows":var i=this.data.multiplier.isPositive()?"-":"+",a=this.data.multiplier.isOne()?"":"\\times"+this.data.multiplier.abs();e+="R_"+(this.data.row2Num+1)+"\\leftarrow R_"+(this.data.row2Num+1)+i+"R_"+(this.data.row1Num+1)+a+"\\\\"+this.data.op1.getTex()+i+this.data.op2.getTex()+a+"="+this.data.result.getTex()}e+="$$",t.append(e)},Fraction.prototype.parseLiteral=function(t){return t instanceof Fraction?t:new Fraction(t)},Fraction.prototype.simplify=function(){var t=GCD(this.top,this.bottom);this.top=this.top.div(t),this.bottom=this.bottom.div(t),this.bottom.lt(0)&&(this.top=this.top.times(-1),this.bottom=this.bottom.times(-1))},Fraction.prototype.divide=function(t){t=this.parseLiteral(t);var e=new Fraction;return e.top=this.top.times(t.bottom),e.bottom=this.bottom.times(t.top),e.simplify(),e},Fraction.prototype.times=function(t){if(t=this.parseLiteral(t),this.top.eq(0)||t.top.eq(0))return new Fraction;var e=new Fraction;return e.bottom=this.bottom.times(t.bottom),e.top=this.top.times(t.top),e.simplify(),e},Fraction.prototype.power=function(t){t=this.parseLiteral(t);for(var e=parseInt(t.top.valueOf()),i=this.clone(),a=1;a<e;a++)i=i.times(this);return i},Fraction.prototype.add=function(t){t=this.parseLiteral(t);var e=new Fraction;return e.top=this.top.times(t.bottom).add(this.bottom.times(t.top)),e.bottom=this.bottom.times(t.bottom),e.simplify(),e},Fraction.prototype.subtract=function(t){t=this.parseLiteral(t);var e=new Fraction;return e.top=this.top.times(t.bottom).minus(this.bottom.times(t.top)),e.bottom=this.bottom.times(t.bottom),e.simplify(),e},Fraction.prototype.reciprocal=function(){return this.top.eq(0)?new Fraction:new Fraction(this.bottom,this.top)},Fraction.prototype.getLiteral=function(){return parseInt(this.top.div(this.bottom).valueOf())},Fraction.prototype.isPositive=function(){return this.top.gt(0)},Fraction.prototype.abs=function(){return new Fraction(this.top.abs(),this.bottom.abs())},Fraction.prototype.isZero=function(){return this.top.eq(0)},Fraction.prototype.isOne=function(){return this.bottom.eq(this.top)},Fraction.prototype.toString=function(){return this.top.eq(0)?"0":this.bottom.eq(1)?this.top.toString():this.isOne()?"1":this.top.toString()+"/"+this.bottom.toString()},Fraction.prototype.clone=function(){return new Fraction(this.top,this.bottom)},Fraction.prototype.getTex=function(){return this.isOne()?"1":this.isZero()?"0":this.bottom.eq(1)?this.top.toString():"\\frac{"+this.top.toString()+"}{"+this.bottom.toString()+"}"},Matrix.prototype.update=function(t,e,i){this.matrix[parseInt(t)][parseInt(e)]=i instanceof Fraction?i:new Fraction(i)},Matrix.prototype.getCell=function(t,e){return this.matrix[t][e]},Matrix.prototype.numRows=function(){return this.matrix.length},Matrix.prototype.numCols=function(){return this.matrix[0].length},Matrix.prototype.clone=function(){for(var t=[],e=0;e<this.numRows();e++){for(var i=[],a=0;a<this.numCols();a++)i.push(this.getCell(e,a).clone());t.push(i)}return new Matrix(t)},Matrix.prototype.determinant=function(){if(2==this.numRows())return this.getCell(0,0).times(this.getCell(1,1)).subtract(this.getCell(1,0).times(this.getCell(0,1)));for(var t=this.reduceToReducedEchF(),e=t.multiplier,i=t.numRows()-1,a=new Fraction,n=1,r=0;r<t.numCols();r++,n*=-1)t.matrix[i][r].isZero()||(a=a.add(t.subMatrix(i,r).det().times(n).times(t.matrix[i][r])));return a.times(e)},Matrix.prototype.subMatrix=function(t,e){for(var i=[],a=0;a<this.numRows();a++)if(a!=t){for(var n=[],r=0;r<this.numCols();r++)r!=e&&n.push(this.getCell(a,r).clone());i.push(n)}return new Matrix(i)},Matrix.prototype.det=function(){return this.determinant()},Matrix.prototype.transpose=function(){for(var t=[],e=0;e<this.numCols();e++){for(var i=[],a=0;a<this.numRows();a++)i.push(this.getCell(a,e));t.push(i)}return new Matrix(t)},Matrix.prototype.concat=function(t){for(var e=this.clone().matrix,i=0;i<e.length;i++)e[i]=e[i].concat(t.matrix[i]);return new Matrix(e)},Matrix.prototype.inverse=function(){var t=this.getIdentity(this.numCols()),e=this.concat(t),i=e.clone();this.step.push(new CalculationStep({type:"augment",op1:this.clone(),result:i,op2:t,message:"(the identity matrix)"})),e=e.reduceToReducedEchF(this.numCols(),this.step),this.step.push(new CalculationStep({type:funcENUM.ROWREDUCE,op1:i,result:e.clone()}));for(var a=0;a<this.numRows();a++){for(var n=0;n<this.numCols();n++)if(n==a){if(!e.getCell(a,n).isOne())throw"Matrix non invertible"}else if(!e.getCell(a,n).isZero())throw"Matrix non invertible";e.matrix[a]=e.matrix[a].slice(this.numCols(),2*this.numCols())}return this.step.push(new CalculationStep({type:"splitAug",op1:e})),e},Matrix.prototype.add=function(t){for(var e=[],i=0;i<this.numRows();i++){for(var a=[],n=0;n<this.numCols();n++)a.push(this.getCell(i,n).add(t.getCell(i,n)));e.push(a)}return new Matrix(e)},Matrix.prototype.subtract=function(t){for(var e=[],i=0;i<this.numRows();i++){for(var a=[],n=0;n<this.numCols();n++)a.push(this.getCell(i,n).subtract(t.getCell(i,n)));e.push(a)}return new Matrix(e)},Matrix.prototype.times=function(t){if(!(t instanceof Matrix))return this.timesScalar(t);if(this.numCols()!=t.numRows()||this.numRows()!=t.numCols())throw"Dimension mismatch, can't multiply "+this.numRows()+"x"+this.numCols()+" by "+t.numRows()+"x"+t.numCols();for(var e=new Matrix(this.numRows(),t.numCols()),i=0;i<this.numRows();i++)for(var a=0;a<this.numCols();a++){for(var n=new Fraction,r=0;r<this.numCols();r++)n=n.add(this.getCell(i,r).times(t.getCell(r,a)));e.update(i,a,n)}return e},Matrix.prototype.timesScalar=function(t){for(var e=new Matrix(this.numRows(),this.numCols()),i=0;i<this.numRows();i++)for(var a=0;a<this.numCols();a++)e.update(i,a,this.getCell(i,a).times(t));return e},Matrix.prototype.divide=function(t,e){return this.step=e,t.step=e,t instanceof Matrix?this.times(t.inverse()):t instanceof Fraction?this.times(t.reciprocal()):this.times(new Fraction(1,t))},Matrix.prototype.power=function(t){if(this.numCols()!=this.numRows())throw"You can only calculate powers of square matricies!";var e;if(t<0)e=this.inverse(),t=Math.abs(t);else{if(0===t)return this.getIdentity();e=this}var a=e.clone();for(i=1;i<t;i++){var n={type:"*",op1:e.clone(),op2:a};e=a.times(e),n.result=e.clone(),this.step.push(new CalculationStep(n))}return e},Matrix.prototype.conjugate=function(t){return t.inverse().times(this).times(t)},Matrix.prototype.performFunction=function(t,e,i){switch(this.step=i,t){case funcENUM.TRANSPOSE:return this.transpose();case funcENUM.INVERSE:return this.inverse();case funcENUM.RANK:return null;case funcENUM.DET:return this.det();case funcENUM.DIAGONALIZE:return null;case funcENUM.ROWREDUCE:return this.reduceToReducedEchF();case funcENUM.SOLVAUG:return this.reduceToReducedEchF(-1);case funcENUM.ID:return this.getIdentity(e[0],e[1]);case funcENUM.ZEROS:return this.getZeros(e[0],e[1])}throw"Something weird just happened!"},Matrix.prototype.reduceToReducedEchF=function(t,e){(void 0===t||t>this.numCols())&&(t=this.numCols()),void 0===e?e=this.step:t==-1&&t--;for(var i=this.numRows(),a=this.clone(),n=0,r=0;r<t&&n<i;r++){if(a.getCell(n,r).isZero()){var o=a.getNonZeroRows(n,r);if(o==-1)continue;a.swap(o,n),e.push(new CalculationStep({type:"swap",op1:o,result:a.clone(),op2:n}))}var s=a.getCell(n,r).reciprocal();if(!s.isOne()){a.multiplier=a.multiplier.divide(s);var c={type:"multiplyRow",op1:a.clone(),op2:s,rowNum:n};a.matrix[n]=a.multiplyRow(n,s),c.result=a.clone(),e.push(new CalculationStep(c))}a.kill(n,r,e),n++}return a},Matrix.prototype.kill=function(t,e,i){for(var a=0;a<this.numRows();a++)if(a!=t){var n=this.getCell(a,e);if(!n.isZero()){var r={type:"subtractRows",op1:new Matrix(this.matrix[a]).clone(),op2:new Matrix(this.matrix[t]).clone(),multiplier:n,row1Num:t,row2Num:a};this.matrix[a]=this.subtractRows(this.matrix[a],this.multiplyRow(t,n),i),r.result=new Matrix(this.matrix[a]).clone(),i.push(new CalculationStep(r))}}},Matrix.prototype.getNonZeroRows=function(t,e){for(t++;t<this.numRows()&&this.getCell(t,e).isZero();)t++;return t==this.numRows()?-1:t},Matrix.prototype.subtractRows=function(t,e){if(t.length!=e.length)throw"Something weird happened!";for(var i=[],a=0;a<t.length;a++)i.push(t[a].subtract(e[a]));return i},Matrix.prototype.multiplyRow=function(t,e){for(var i=[],a=0;a<this.numCols();a++)i.push(this.getCell(t,a).clone().times(e));return i},Matrix.prototype.swap=function(t,e){var i=this.matrix[t];this.matrix[t]=this.matrix[e],this.matrix[e]=i,this.multiplier=this.multiplier.times(-1)},Matrix.prototype.resize=function(t,e){if(t=parseInt(t),e=parseInt(e),t<this.numRows())this.matrix=this.matrix.slice(0,t);else if(t!=this.numRows()){for(var i=[],a=0;a<e;a++)i.push(new Fraction);this.matrix.push(i)}if(e<this.numCols())for(var n=0;n<t;n++)this.matrix[n]=this.matrix[n].slice(0,e);else if(e!=this.numCols())for(var a=0;a<t;a++)this.matrix[a].push(new Fraction)},Matrix.prototype.getIdentity=function(t,e){void 0===t&&void 0!==e&&(t=e),void 0!==t&&void 0===e&&(e=t),void 0===t&&(t=this.numRows()),void 0===e&&(e=this.numCols());for(var i=[],a=0;a<t;a++){for(var n=[],r=0;r<e;r++)a==r?n.push(new Fraction(1)):n.push(new Fraction);i.push(n)}return new Matrix(i)},Matrix.prototype.getZeros=function(t,e){void 0===t&&void 0!==e&&(t=e),void 0!==t&&void 0===e&&(e=t);for(var i=[],a=0;a<t;a++){for(var n=[],r=0;r<e;r++)n.push(new Fraction);i.push(n)}return new Matrix(i)},Matrix.prototype.getTex=function(){for(var t="\\begin{bmatrix}",e=0;e<this.numRows();e++){for(var i=0;i<this.numCols();i++)t+=this.getCell(e,i).getTex()+(i+1<this.numCols()?"&":"");t+="\\\\"}return t+="\\end{bmatrix}"},Matrix.prototype.getRowTex=function(t){for(var e="\\begin{bmatrix}",i=0;i<this.numCols();i++)e+=this.getCell(t,i).getTex()+(i+1<this.numCols()?"&":"");return e+"\\end{bmatrix}"};var funcENUM={NONE:"#",TRANSPOSE:"#T",INVERSE:"#I",RANK:"#R",DET:"#D",EIGEN:"#E",DIAGONALIZE:"#DI",ROWREDUCE:"#RRD",SOLVAUG:"#SA",ID:"#ID",ZEROS:"#ZE",isFunction:function(t){var e=!1;return $.each(this,function(i,a){a==t&&(e=!0)}),e},getString:function(t){switch(t){case this.TRANSPOSE:return"Transpose";case this.RANK:return"Rank";case this.INVERSE:return"Inverse";case this.DET:return"Determinant";case this.EIGEN:return"Eigenvalues/Vectors";case this.DIAGONALIZE:return"Diagonal form";case this.ROWREDUCE:case this.SOLVAUG:return"Reduced Row Echelon Form";case this.ID:return"Identity matrix";case this.ZEROS:return"0 matrix"}return"NOTHING"}};$(document).ready(function(){(new ApplicationManager).init(),interact(".draggable").draggable({snap:{targets:[interact.createSnapGrid({x:20,y:20})],range:1/0,relativePoints:[{x:0,y:0}]},inertia:!0,restrict:{restriction:"#mainBody",endOnly:!1,elementRect:{top:0,left:0,bottom:0,right:1}},autoScroll:!0,onmove:function(t){var e=t.target,i=(parseFloat(e.getAttribute("data-x"))||0)+t.dx,a=(parseFloat(e.getAttribute("data-y"))||0)+t.dy;e.style.webkitTransform=e.style.transform="translate("+i+"px, "+a+"px)",e.setAttribute("data-x",i),e.setAttribute("data-y",a)}}).allowFrom(".dragHandle")});