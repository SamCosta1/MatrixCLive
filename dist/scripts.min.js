function CalculationArray(){this.steps=[]}function CalculationStep(t){this.data=t,this.subSteps=[]}function Fraction(t,e){this.top=t,this.bottom=e,void 0===t?(this.top="0",this.bottom="1"):void 0===e&&(this.bottom="1"),this.bottom=this.bottom.toString(),this.top=this.top.toString(),this.top.includes("/")&&(this.top=t.split("/")[0],this.bottom=t.split("/")[1]),this.top=new Big(this.top),this.bottom=new Big(this.bottom);var i=!this.top.mod(1).eq(0);if(botDec=!this.bottom.mod(1).eq(0),i||botDec){var a=i?this.top.toString().split(".")[1].length:0,r=botDec?this.bottom.toString().split(".")[1].length:0,n=Big(10).pow(r>a?r:a);this.top=this.top.times(n),this.bottom=this.bottom.times(n)}this.simplify()}function GCD(t,e){if(e.eq(0))return 1;var i=t.mod(e);return i.eq(0)?e:GCD(e,i)}function Matrix(t,e){this.matrix=t,t&&t[0]instanceof Fraction&&(this.matrix=[this.matrix]),this.multiplier=new Fraction("1"),void 0===t?this.matrix=this.getZeros(3).matrix:isNaN(t)||(this.matrix=this.getZeros(t,e).matrix)}function getEnum(t){switch(t.toLowerCase()){case"transpose":case"trans":return funcENUM.TRANSPOSE;case"inverse":case"inv":return funcENUM.INVERSE;case"rank":return funcENUM.RANK;case"det":case"determinant":return funcENUM.DET;case"eigen":return funcENUM.EIGEN;case"diagonalize":return funcENUM.DIAGONALIZE;case"rowreduce":return funcENUM.ROWREDUCE;case"solveaugmented":case"solveaugmentedmatrix":return funcENUM.SOLVAUG;case"id":case"identity":return funcENUM.ID;case"zeros":return funcENUM.ZEROS}return funcENUM.NONE}function expandSidebar(){$(".sidebar").width(.75*$(window).width()),$(".snapHandle").removeClass("expand")}function collapseSidebar(){$(".sidebar").width(16),$(".snapHandle").addClass("expand")}function getNextFreeLetter(){if(letterIndex++,letterIndex>=alphabet.length&&(letterIndex=0),isValid(alphabet[letterIndex]))return alphabet[letterIndex];var t=alphabet[letterIndex]+parseInt(100*Math.random());return isValid(t)?t:void getNextFreeLetter()}function commandInput(t){try{var e=Date.now();$("#errDisplay").hide(),Parser().parse(t),$("#cmdinput").val(base);var i=Date.now()-e;successHandle(i),console.log("Operation done in "+i+"ms")}catch(t){errorHandle(t),$("#cmdinput").val($("#cmdinput").val().replace(/\n/g,""))}}function errorHandle(t){console.log(t),$("#errDisplay").css("color","red"),$("#errDisplay").text(t).show()}function successHandle(t){$("#errDisplay").css("color","#008e0d"),$("#errDisplay").text("Command Successful! ("+t+" ms)").show(200),setTimeout(function(){$("#errDisplay").hide(500)},2e3)}function deleteMatrix(t){variables.delete($(t).attr("id").split("-")[1]),t.remove(),$("#bin").attr("src","img/bin.png")}function newInputComp(t,e){var a,r;null!==e&&void 0!==e||(e=new Matrix),e instanceof Matrix?(r=e.numCols(),a=e.numRows()):a=r=1,variables.set(t,e);var n=$("<div>",{id:"MAT-"+t,class:"matInput draggable drag-drop","data-clicked":0}),o=$("<img>",{class:"handle noSelect",src:"img/dragHandle.png"}),s=$("<span>",{class:"label noSelect"}),c=$("<label>",{class:"pull-left noSelect"}),l=$("<input>",{class:"clickedit",type:"text"});interact(".draggable").draggable({snap:{targets:[interact.createSnapGrid({x:20,y:20})],range:1/0,relativePoints:[{x:0,y:0}]},inertia:!0,restrict:{restriction:"#mainBody",endOnly:!1,elementRect:{top:0,left:0,bottom:0,right:1}},autoScroll:!0,onmove:dragMoveListener}).allowFrom(".handle"),window.dragMoveListener=dragMoveListener,c.append(t),s.append(c),s.append(l),s.append("     = "),n.append(s);var u=$("<div>",{class:"matContainer"}),p=$("<table>",{class:isNaN(e)?"matGui":"",id:"t"+count});for(p.attr("data-cols",r),p.attr("data-rows",a),i=0;i<a;i++){var d=$("<tr>");for(j=0;j<r;j++){var h=$("<td>");h.append(getCell(i,j,e instanceof Matrix?e.getCell(i,j).toString():e instanceof Fraction?e.toString():e)),d.append(h)}p.append(d)}if(u.append(p),n.append(u),e instanceof Matrix){$modifiers=$("<span>",{class:"guiModifiers"});var m=function(){return $("<img>",{src:"img/arrow.png"})};$colbtn=$("<button>",{class:"addCol colButton rowColModifier noSelect"}),$colbtn.append(m()),$rowbtn=$("<button>",{class:"addRow rowButton rowColModifier noSelect flipY"}),$rowbtn.append(m()),$rmvColbtn=$("<button>",{class:"rmvCol colButton rowColModifier noSelect flip"}),$rmvColbtn.append(m()),$rmvRowbtn=$("<button>",{class:"rmvRow rowButton rowColModifier noSelect addLeftMargin"}),$rmvRowbtn.append(m()),$colbtn.attr("data-tableid","t"+count),$rowbtn.attr("data-tableid","t"+count),$rmvRowbtn.attr("data-tableid","t"+count),$rmvColbtn.attr("data-tableid","t"+count),$colbtn.click(function(t){t.stopImmediatePropagation();var e=0;p=$("#"+$(this).attr("data-tableid"));var i=p.attr("data-cols")-1,a=p.attr("data-rows");p.attr("data-cols",i+2),p.find("tr").each(function(){var t=$("<td>");t.append(getCell(e,i+1,"0")),e++,$(this).find("td").eq(i).after(t)});var r=$(this).closest(".matInput").attr("id").split("-")[1];variables.get(r).resize(parseInt(a),i+2)}),$rowbtn.click(function(t){t.stopImmediatePropagation(),p=$("#"+$(this).attr("data-tableid"));var e=p.attr("data-cols"),a=p.attr("data-rows");for(p.attr("data-rows",parseInt(a)+1),d=$("<tr>"),i=0;i<e;i++)h=$("<td>"),h.append(getCell(a,i,"0")),d.append(h);p.append(d);var r=$(this).closest(".matInput").attr("id").split("-")[1];variables.get(r).resize(parseInt(a)+1,parseInt(e))}),$rmvColbtn.click(function(t){t.stopImmediatePropagation();var e=$("#"+$(this).attr("data-tableid")),i=parseInt(e.attr("data-cols")),a=parseInt(e.attr("data-rows"));if(i>1){$("#"+$(this).attr("data-tableid")+" td:last-child").remove(),i--,e.attr("data-cols",i);var r=$(this).closest(".matInput").attr("id").split("-")[1];variables.get(r).resize(a,i)}}),$rmvRowbtn.click(function(t){t.stopImmediatePropagation();var e=$("#"+$(this).attr("data-tableid")),i=parseInt(e.attr("data-rows")),a=parseInt(e.attr("data-cols"));if(i>1){$("#"+$(this).attr("data-tableid")+" tr:last-child").remove(),i--,e.attr("data-rows",i);var r=$(this).closest(".matInput").attr("id").split("-")[1];variables.get(r).resize(i,a)}}),n.click(function(t){t.stopImmediatePropagation();var e=$(this).attr("id");1==$(this).attr("data-clicked")?($(this).css("background-color","rgba(204, 204, 204, 0.2)"),$(this).attr("data-clicked",0),selected.splice(selected.indexOf(e),1)):($(this).css("background-color","rgba(99, 182, 255, 0.2)"),$(this).attr("data-clicked",1),selected.push(e)),$selectedMatrix=this}),count++,$modifiers.append($rmvRowbtn),$modifiers.append($rowbtn),$modifiers.append($rmvColbtn),$modifiers.append($colbtn),n.append($modifiers)}n.append(o),$("#matDefinitions").append(n),$(".clickedit").hide().focusout(endEdit).keyup(function(t){return t.stopImmediatePropagation(),!(t.which&&13==t.which||t.keyCode&&13==t.keyCode)||(endEdit(t),!1)}).prev().click(function(t){t.stopImmediatePropagation(),$(this).hide(),$(this).next().show().focus()})}function getCell(t,e,i){var a=$("<input>",{class:"matrixCell",type:"text"});return a.val(i),"0"==i&&a.css("color","gray"),a.attr("data-row",t),a.attr("data-col",e),a.click(function(t){t.stopImmediatePropagation(),"0"==$(this).val()&&$(this).val(""),$(this).css("color","black")}),a.change(function(t){t.stopImmediatePropagation();var e=$(this).closest(".matInput").attr("id").split("-")[1],i=$(this).attr("data-row"),r=$(this).attr("data-col");""===$(this).val().trim()?(a.css("color","gray"),variables.get(e).update(i,r,0),$(this).val("0")):variables.get(e).update(i,r,$(this).val())}),a.keyup(function(t){t.stopImmediatePropagation()}),a}function dragMoveListener(t){var e=t.target,i=(parseFloat(e.getAttribute("data-x"))||0)+t.dx,a=(parseFloat(e.getAttribute("data-y"))||0)+t.dy;e.style.webkitTransform=e.style.transform="translate("+i+"px, "+a+"px)",e.setAttribute("data-x",i),e.setAttribute("data-y",a)}function endEdit(t){t.stopImmediatePropagation();var e=$(t.target),i=e&&e.prev(),a=makeCammelCase(e.val()),r=!1;if(isValid(a,!1)){i.text(a);var n=variables.get(i.closest("div").attr("id").split("-")[1]);variables.delete(i.closest("div").attr("id").split("-")[1]),variables.set(a,n),i.closest("div").attr("id","MAT-"+a)}else i.text(i.closest("div").attr("id").split("-")[1]),r=!0;e.hide(),i.show(),e.val(""),r&&errorHandle("Invalid Variable Name :(")}function isValid(t,e){return/^[a-z0-9]+$/i.test(t)&&(!!e||void 0===variables.get(t))&&getEnum(t)===funcENUM.NONE}function makeCammelCase(t){return t=t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()}),t=t.replace(/ /g,"").replace(/-/g,""),t.length>1&&(t=t.charAt(0).toLowerCase()+t.slice(1)),t}function updateGUI(t,e){if(variables.set(t,e),e instanceof Matrix){var i=parseInt(e.numRows()-$("#MAT-"+t).find("table").attr("data-rows")),a=parseInt(e.numCols()-$("#MAT-"+t).find("table").attr("data-cols"));if(0!==i||0!==a){for(var r=$("#MAT-"+t).find(".guiModifiers"),n=r.find(".addCol"),o=r.find(".rmvCol"),s=r.find(".addRow"),c=r.find(".rmvRow"),l=0;l<Math.abs(i);l++)i<0?c.trigger("click"):s.trigger("click");for(var l=0;l<Math.abs(a);l++)a<0?o.trigger("click"):n.trigger("click")}}$("#MAT-"+t).find("table tr").each(function(){$(this).find("td").each(function(){var t=$(this).find("input"),i=t.attr("data-row"),a=t.attr("data-col");t.val(e instanceof Matrix?e.getCell(i,a):e.toString())})})}CalculationArray.prototype.push=function(t){this.steps.push(t)},CalculationArray.prototype.render=function(t){if(0!==this.steps.length){for(var e=$('<div class="calculation">'),i=0;i<this.steps.length;i++)this.steps[i].render(e);t.prepend(e),MathJax.Hub.Queue(["Typeset",MathJax.Hub])}};var calculations=new Map;CalculationStep.prototype.push=function(t){this.subSteps.push(t)},CalculationStep.prototype.length=function(){return this.subSteps.length},CalculationStep.prototype.render=function(t){var e=$("<div>",{class:"calcStepContainer"});if(this.length()>0){for(var i=$("<div>",{class:"calcStepContainer subContainer"}),a=0;a<this.length();a++)this.subSteps[a].render(i);e.append(i)}var r=$("<div>",{class:"calcStepContainer resultContainer"});this.renderThis(r),e.append(r),t.append(e)},CalculationStep.prototype.renderThis=function(t){var e="$$";switch(this.data.type){case funcENUM.INVERSE:e+="\\text{inverse} \\Bigg("+this.data.op1.getTex()+"\\Bigg) = "+this.data.result.getTex();break;case funcENUM.DET:e+="\\text{determinant} \\Bigg("+this.data.op1.getTex()+"\\Bigg) = "+this.data.result.getTex();break;case funcENUM.ROWREDUCE:e+="\\text{reduced row echelon form of }"+this.data.op1.getTex()+" is "+this.data.result.getTex();break;case funcENUM.TRANSPOSE:e+="\\text{transpose} \\Bigg("+this.data.op1.getTex()+"\\Bigg) = "+this.data.result.getTex();break;case"+":case"-":e+=this.data.op1.getTex()+this.data.type+this.data.op2.getTex()+"="+this.data.result.getTex();break;case"*":e+=this.data.op1.getTex()+"\\times"+this.data.op2.getTex()+"="+this.data.result.getTex();break;case"/":e+="\\frac{"+this.data.op1.getTex()+"}{"+this.data.op2.getTex()+"}="+this.data.result.getTex();break;case"^":e+="("+this.data.op1.getTex()+")^{"+this.data.op2.getTex()+"} = "+this.data.result.getTex();break;case"splitAug":e+="\\text{Take the right hand side as the inverse: }"+this.data.op1.getTex();break;case"swap":e+="\\text{Swap } R_"+(this.data.op1+1)+"\\text{ and }R_ "+(this.data.op2+1)+" => "+this.data.result.getTex();break;case"augment":e+="\\text{augment } "+this.data.op1.getTex()+" \\text{with} "+this.data.op2.getTex()+" \\text{"+this.data.message+"} \\\\ =>"+this.data.result.getTex();break;case"multiplyRow":e+="\\text{Multiply } R_"+(this.data.rowNum+1)+"\\text{ by }"+this.data.op2.getTex()+"\\\\"+this.data.op1.getRowTex(this.data.rowNum)+"\\times"+this.data.op2.getTex()+"\\rightarrow"+this.data.result.getTex();break;case"subtractRows":var i=this.data.multiplier.isPositive()?"-":"+",a=this.data.multiplier.isOne()?"":"\\times"+this.data.multiplier.abs();e+="R_"+(this.data.row2Num+1)+"\\leftarrow R_"+(this.data.row2Num+1)+i+"R_"+(this.data.row1Num+1)+a+"\\\\"+this.data.op1.getTex()+i+this.data.op2.getTex()+a+"="+this.data.result.getTex()}e+="$$",t.append(e)},Fraction.prototype.parseLiteral=function(t){return t instanceof Fraction?t:new Fraction(t)},Fraction.prototype.simplify=function(){var t=GCD(this.top,this.bottom);this.top=this.top.div(t),this.bottom=this.bottom.div(t),this.bottom.lt(0)&&(this.top=this.top.times(-1),this.bottom=this.bottom.times(-1))},Fraction.prototype.divide=function(t){t=this.parseLiteral(t);var e=new Fraction;return e.top=this.top.times(t.bottom),e.bottom=this.bottom.times(t.top),e.simplify(),e},Fraction.prototype.times=function(t){if(t=this.parseLiteral(t),this.top.eq(0)||t.top.eq(0))return new Fraction;var e=new Fraction;return e.bottom=this.bottom.times(t.bottom),e.top=this.top.times(t.top),e.simplify(),e},Fraction.prototype.power=function(t){t=this.parseLiteral(t);for(var e=parseInt(t.top.valueOf()),i=this.clone(),a=1;a<e;a++)i=i.times(this);return i},Fraction.prototype.add=function(t){t=this.parseLiteral(t);var e=new Fraction;return e.top=this.top.times(t.bottom).add(this.bottom.times(t.top)),e.bottom=this.bottom.times(t.bottom),e.simplify(),e},Fraction.prototype.subtract=function(t){t=this.parseLiteral(t);var e=new Fraction;return e.top=this.top.times(t.bottom).minus(this.bottom.times(t.top)),e.bottom=this.bottom.times(t.bottom),e.simplify(),e},Fraction.prototype.reciprocal=function(){return this.top.eq(0)?new Fraction:new Fraction(this.bottom,this.top)},Fraction.prototype.getLiteral=function(){return parseInt(this.top.div(this.bottom).valueOf())},Fraction.prototype.isPositive=function(){return this.top.gt(0)},Fraction.prototype.abs=function(){return new Fraction(this.top.abs(),this.bottom.abs())},Fraction.prototype.isZero=function(){return this.top.eq(0)},Fraction.prototype.isOne=function(){return this.bottom.eq(this.top)},Fraction.prototype.toString=function(){return this.top.eq(0)?"0":this.bottom.eq(1)?this.top.toString():this.isOne()?"1":this.top.toString()+"/"+this.bottom.toString()},Fraction.prototype.clone=function(){return new Fraction(this.top,this.bottom)},Fraction.prototype.getTex=function(){return this.isOne()?"1":this.isZero()?"0":this.bottom.eq(1)?this.top.toString():"\\frac{"+this.top.toString()+"}{"+this.bottom.toString()+"}"},Matrix.prototype.update=function(t,e,i){this.matrix[parseInt(t)][parseInt(e)]=i instanceof Fraction?i:new Fraction(i)},Matrix.prototype.getCell=function(t,e){return this.matrix[t][e]},Matrix.prototype.numRows=function(){return this.matrix.length},Matrix.prototype.numCols=function(){return this.matrix[0].length},Matrix.prototype.clone=function(){for(var t=[],e=0;e<this.numRows();e++){for(var i=[],a=0;a<this.numCols();a++)i.push(this.getCell(e,a).clone());t.push(i)}return new Matrix(t)},Matrix.prototype.determinant=function(){if(2==this.numRows())return this.getCell(0,0).times(this.getCell(1,1)).subtract(this.getCell(1,0).times(this.getCell(0,1)));for(var t=this.reduceToReducedEchF(),e=t.multiplier,i=t.numRows()-1,a=new Fraction,r=1,n=0;n<t.numCols();n++,r*=-1)t.matrix[i][n].isZero()||(a=a.add(t.subMatrix(i,n).det().times(r).times(t.matrix[i][n])));return a.times(e)},Matrix.prototype.subMatrix=function(t,e){for(var i=[],a=0;a<this.numRows();a++)if(a!=t){for(var r=[],n=0;n<this.numCols();n++)n!=e&&r.push(this.getCell(a,n).clone());i.push(r)}return new Matrix(i)},Matrix.prototype.det=function(){return this.determinant()},Matrix.prototype.transpose=function(){for(var t=[],e=0;e<this.numCols();e++){for(var i=[],a=0;a<this.numRows();a++)i.push(this.getCell(a,e));t.push(i)}return new Matrix(t)},Matrix.prototype.concat=function(t){for(var e=this.clone().matrix,i=0;i<e.length;i++)e[i]=e[i].concat(t.matrix[i]);return new Matrix(e)},Matrix.prototype.inverse=function(){var t=this.getIdentity(this.numCols()),e=this.concat(t),i=e.clone();this.step.push(new CalculationStep({type:"augment",op1:this.clone(),result:i,op2:t,message:"(the identity matrix)"})),e=e.reduceToReducedEchF(this.numCols(),this.step),this.step.push(new CalculationStep({type:funcENUM.ROWREDUCE,op1:i,result:e.clone()}));for(var a=0;a<this.numRows();a++){for(var r=0;r<this.numCols();r++)if(r==a){if(!e.getCell(a,r).isOne())throw"Matrix non invertible"}else if(!e.getCell(a,r).isZero())throw"Matrix non invertible";e.matrix[a]=e.matrix[a].slice(this.numCols(),2*this.numCols())}return this.step.push(new CalculationStep({type:"splitAug",op1:e})),e},Matrix.prototype.add=function(t){for(var e=[],i=0;i<this.numRows();i++){for(var a=[],r=0;r<this.numCols();r++)a.push(this.getCell(i,r).add(t.getCell(i,r)));e.push(a)}return new Matrix(e)},Matrix.prototype.subtract=function(t){for(var e=[],i=0;i<this.numRows();i++){for(var a=[],r=0;r<this.numCols();r++)a.push(this.getCell(i,r).subtract(t.getCell(i,r)));e.push(a)}return new Matrix(e)},Matrix.prototype.times=function(t){if(!(t instanceof Matrix))return this.timesScalar(t);if(this.numCols()!=t.numRows()||this.numRows()!=t.numCols())throw"Dimension mismatch, can't multiply "+this.numRows()+"x"+this.numCols()+" by "+t.numRows()+"x"+t.numCols();for(var e=new Matrix(this.numRows(),t.numCols()),i=0;i<this.numRows();i++)for(var a=0;a<this.numCols();a++){for(var r=new Fraction,n=0;n<this.numCols();n++)r=r.add(this.getCell(i,n).times(t.getCell(n,a)));e.update(i,a,r)}return e},Matrix.prototype.timesScalar=function(t){for(var e=new Matrix(this.numRows(),this.numCols()),i=0;i<this.numRows();i++)for(var a=0;a<this.numCols();a++)e.update(i,a,this.getCell(i,a).times(t));return e},Matrix.prototype.divide=function(t,e){return this.step=e,t.step=e,t instanceof Matrix?this.times(t.inverse()):t instanceof Fraction?this.times(t.reciprocal()):this.times(new Fraction(1,t))},Matrix.prototype.power=function(t){if(this.numCols()!=this.numRows())throw"You can only calculate powers of square matricies!";var e;if(t<0)e=this.inverse(),t=Math.abs(t);else{if(0===t)return this.getIdentity();e=this}var a=e.clone();for(i=1;i<t;i++){var r={type:"*",op1:e.clone(),op2:a};e=a.times(e),r.result=e.clone(),this.step.push(new CalculationStep(r))}return e},Matrix.prototype.conjugate=function(t){return t.inverse().times(this).times(t)},Matrix.prototype.performFunction=function(t,e,i){switch(this.step=i,t){case funcENUM.TRANSPOSE:return this.transpose();case funcENUM.INVERSE:return this.inverse();case funcENUM.RANK:return null;case funcENUM.DET:return this.det();case funcENUM.DIAGONALIZE:return null;case funcENUM.ROWREDUCE:return this.reduceToReducedEchF();case funcENUM.SOLVAUG:return this.reduceToReducedEchF(-1);case funcENUM.ID:return this.getIdentity(e[0],e[1]);case funcENUM.ZEROS:return this.getZeros(e[0],e[1])}throw"Something weird just happened!"},Matrix.prototype.reduceToReducedEchF=function(t,e){(void 0===t||t>this.numCols())&&(t=this.numCols()),void 0===e?e=this.step:t==-1&&t--;for(var i=this.numRows(),a=this.clone(),r=0,n=0;n<t&&r<i;n++){if(a.getCell(r,n).isZero()){var o=a.getNonZeroRows(r,n);if(o==-1)continue;a.swap(o,r),e.push(new CalculationStep({type:"swap",op1:o,result:a.clone(),op2:r}))}var s=a.getCell(r,n).reciprocal();if(!s.isOne()){a.multiplier=a.multiplier.divide(s);var c={type:"multiplyRow",op1:a.clone(),op2:s,rowNum:r};a.matrix[r]=a.multiplyRow(r,s),c.result=a.clone(),e.push(new CalculationStep(c))}a.kill(r,n,e),r++}return a},Matrix.prototype.kill=function(t,e,i){for(var a=0;a<this.numRows();a++)if(a!=t){var r=this.getCell(a,e);if(!r.isZero()){var n={type:"subtractRows",op1:new Matrix(this.matrix[a]).clone(),op2:new Matrix(this.matrix[t]).clone(),multiplier:r,row1Num:t,row2Num:a};this.matrix[a]=this.subtractRows(this.matrix[a],this.multiplyRow(t,r),i),n.result=new Matrix(this.matrix[a]).clone(),i.push(new CalculationStep(n))}}},Matrix.prototype.getNonZeroRows=function(t,e){for(t++;t<this.numRows()&&this.getCell(t,e).isZero();)t++;return t==this.numRows()?-1:t},Matrix.prototype.subtractRows=function(t,e){if(t.length!=e.length)throw"Something weird happened!";for(var i=[],a=0;a<t.length;a++)i.push(t[a].subtract(e[a]));return i},Matrix.prototype.multiplyRow=function(t,e){for(var i=[],a=0;a<this.numCols();a++)i.push(this.getCell(t,a).clone().times(e));return i},Matrix.prototype.swap=function(t,e){var i=this.matrix[t];this.matrix[t]=this.matrix[e],this.matrix[e]=i,this.multiplier=this.multiplier.times(-1)},Matrix.prototype.resize=function(t,e){if(t=parseInt(t),e=parseInt(e),t<this.numRows())this.matrix=this.matrix.slice(0,t);else if(t!=this.numRows()){for(var i=[],a=0;a<e;a++)i.push(new Fraction);this.matrix.push(i)}if(e<this.numCols())for(var r=0;r<t;r++)this.matrix[r]=this.matrix[r].slice(0,e);else if(e!=this.numCols())for(var a=0;a<t;a++)this.matrix[a].push(new Fraction)},Matrix.prototype.getIdentity=function(t,e){void 0===t&&void 0!==e&&(t=e),void 0!==t&&void 0===e&&(e=t),void 0===t&&(t=this.numRows()),void 0===e&&(e=this.numCols());for(var i=[],a=0;a<t;a++){for(var r=[],n=0;n<e;n++)a==n?r.push(new Fraction(1)):r.push(new Fraction);i.push(r)}return new Matrix(i)},Matrix.prototype.getZeros=function(t,e){void 0===t&&void 0!==e&&(t=e),void 0!==t&&void 0===e&&(e=t);for(var i=[],a=0;a<t;a++){for(var r=[],n=0;n<e;n++)r.push(new Fraction);i.push(r)}return new Matrix(i)},Matrix.prototype.getTex=function(){for(var t="\\begin{bmatrix}",e=0;e<this.numRows();e++){for(var i=0;i<this.numCols();i++)t+=this.getCell(e,i).getTex()+(i+1<this.numCols()?"&":"");t+="\\\\"}return t+="\\end{bmatrix}"},Matrix.prototype.getRowTex=function(t){for(var e="\\begin{bmatrix}",i=0;i<this.numCols();i++)e+=this.getCell(t,i).getTex()+(i+1<this.numCols()?"&":"");return e+"\\end{bmatrix}"};var funcENUM={NONE:"#",TRANSPOSE:"#T",INVERSE:"#I",RANK:"#R",DET:"#D",EIGEN:"#E",DIAGONALIZE:"#DI",ROWREDUCE:"#RRD",SOLVAUG:"#SA",ID:"#ID",ZEROS:"#ZE",isFunction:function(t){var e=!1;return $.each(this,function(i,a){a==t&&(e=!0)}),e},getString:function(t){switch(t){case this.TRANSPOSE:return"transpose";case this.RANK:return"rank";case this.INVERSE:return"inverse";case this.DET:return"determinant";case this.EIGEN:return"eigenvalues/vectors";case this.DIAGONALIZE:return"diagonal form";case this.ROWREDUCE:case this.SOLVAUG:return"Reduced Echelon Form";case this.ID:return"identity matrix";case this.ZEROS:return"0 matrix"}return"NOTHING"}},Parser=function(){function t(s){if(s=s.replace(/ /g,"").replace(/\n/g,""),s.includes(";")){var c=s.split(";");for(var l in c)t(c[l])}else if(""!==s){var u=s,p="",d=!1;if(s.includes("=")){if(d=!0,p=s.split("=")[0],!isValid(p,!0))throw"Invalid Variable Name :(";s=s.split("=")[1]}else p=getNextFreeLetter();s="("+s+")";var h=new CalculationArray;calculations.set(p,h);var m=e(s);if(!d&&3==m.length)return $("#MAT-"+u).trigger("click"),void $("#MAT-"+u).get(0).scrollIntoView();for(var f=0;f<m.length;f++)if(n(m[f])){for(var g=f;!o(m[g]);){if(r(m[g])){var v=new CalculationStep({type:m[g],op1:m[g-1],op2:m[g+1]}),b=a(m[g],m[g-1],m[g+1],v);v.data.result=b,h.push(v),m.splice(g,2),m[g-1]=b}g--}if(funcENUM.isFunction(m[g-1])){for(var w=[],x=0;!n(m[x+(g+1)]);)","!=m[x+(g+1)]&&w.push(m[x+(g+1)]),x++;var M=new CalculationStep({type:m[g-1],op1:w[0]}),C=i(m[g-1],w,M);M.data.result=C,h.push(M),m.splice(g,x+2),m[g-1]=C}else m.splice(g,1),m.splice(g+1,1);if(0===g)break;f=g-1}if(calculations.get(p).render($(".sidebarBody")),variables.get(p)){if(typeof variables.get(p)!=typeof m[0])throw"object"==typeof m[0]?"You can't assign a matrix to a number":"You can't assign a number to a matrix";updateGUI(p,m[0].clone())}else newInputComp(p,m[0].clone())}}function e(t){var e=1,i=0,a=[];a.add=function(t){o(t)?e++:n(t)&&i++,this.push(t)},a.push("(");for(var r=1;r<t.length;r++){if(c(t[r])&&!c(t[r-1])){for(var s=r-1,l="";!c(t[s]);)l=t[s]+l,s--;var u;if(isNaN(l)){if((u=getEnum(l))==funcENUM.NONE&&"undefined"==typeof(u=variables.get(l))&&","!=(u=l))throw"Sorry, I don't know what '"+l+"' is :("}else u=new Fraction(l),"-"==a[a.length-1]&&isNaN(a[a.length-2])&&(a.pop(),u=u.times(-1)),"+"==a[a.length-1]&&isNaN(a[a.length-2])&&a.pop();a.push(u)}c(t[r])&&a.add(t[r])}if(e>i)throw"Unexpected character (";if(i>e)throw"Unexpected character )";return a}function i(t,e,i){if(e[0]instanceof Matrix)return e[0].performFunction(t,null,i);if(t!=funcENUM.ID&&t!=funcENUM.ZEROS)throw"Cannot perform operation: "+funcENUM.getString(t)+" of "+e[0];return(new Matrix).performFunction(t,e,i)}function a(t,e,i,a){var r;switch(t){case"+":if(e instanceof Matrix&&!(i instanceof Matrix)||i instanceof Matrix&&!(e instanceof Matrix))throw"You can't add a matrix and number sorry!";r=e.add(i);break;case"-":if(e instanceof Matrix&&!(i instanceof Matrix)||i instanceof Matrix&&!(e instanceof Matrix))throw"You can't add a matrix and number sorry!";r=e.subtract(i);break;case"/":if(!(e instanceof Matrix)&&i instanceof Matrix)throw"You can't divide a number by a matrix!";r=e.divide(i,a);break;case"*":r=e instanceof Matrix?e.times(i):i instanceof Matrix?i.times(e):e.times(i);break;case"^":if(e instanceof Matrix)e.step=a,r=i instanceof Matrix?e.conjugate(i):e.power(i);else{if(!(e instanceof Fraction&&i instanceof Fraction))throw"That's not valid maths! ";r=e.power(i)}}return r}function r(t){return"+^-*/".split("").indexOf(t)>=0}function n(t){return")"==t}function o(t){return"("==t}function s(t){return n(t)||o(t)}function c(t){return r(t)||s(t)||","==t}return{parse:t}};$(".sidebar").ready(function(){$(".sidebar").css("max-width",$(window).width());$(".handle").mousedown(function(){$(document).bind("mousemove",function(t){t.stopImmediatePropagation(),$(".sidebar").width($(".sidebar").width()+$(".sidebar").position().left-t.pageX),16!==$(".sidebar").width()?$(".snapHandle").removeClass("expand"):$(".snapHandle").addClass("expand")})}),$(".handle").dblclick(function(){16!==$(".sidebar").width()?collapseSidebar():expandSidebar()}),$(document).mouseup(function(t){$(document).unbind("mousemove")}),$(".snapHandle").click(function(){16==$(".sidebar").width()?expandSidebar():collapseSidebar()});var t=16;$(".fullScreen").click(function(){$(".fullScreen").hasClass("unfullScreen")?$(".sidebar").css("width",t):(t=$(".sidebar").width(),$(".sidebar").width($(window).width())),$(".fullScreen").toggleClass("unfullScreen")})}),$(window).resize(function(){$(".sidebar").css("max-width",$(window).width())});var variables=new Map,alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),letterIndex=-1,base="MatCalculator >> ",regex=new RegExp("^"+base,"i"),comHist=[];comHist.add=function(t){this.indexOf(t)<0&&this.push(t)};var histPos=0;interact(".dropzone").dropzone({accept:".matInput",ondragenter:function(t){$("#bin").attr("src","img/openBin.png")},ondragleave:function(t){$("#bin").attr("src","img/bin.png")},ondrop:function(t){deleteMatrix(t.relatedTarget);var e=selected.indexOf($(t.relatedTarget).attr("id"));e!=-1&&selected.splice(e,1)}}),$(document).keyup(function(t){if(46==t.keyCode)for(var e in selected)deleteMatrix($("#"+selected[e]));selected=[]});var count=0,selected=[];$(document).ready(function(){$("#cmdinput").on("input",function(t){var e=$(this).val();regex.test(e)||$(this).val(base)}).keyup(function(t){t.stopImmediatePropagation();var e=t.keyCode?t.keyCode:t.which;if(13==e){var i=$(this).val().slice(base.length);comHist.add(i.replace(/\n/g,"")),histPos++,commandInput(i)}else 38==e&&comHist.length>0?(histPos>0&&histPos--,$(this).val(base+comHist[histPos])):40==e&&comHist.length>0?(histPos<comHist.length-1&&histPos++,$(this).val(base+comHist[histPos])):histPos=comHist.length}),$("#btnNewMat").hover(function(){$("#newLabel").show()},function(){$("#newLabel").hide()}).click(function(){newInputComp(getNextFreeLetter())})});